<!DOCTYPE html>
<html lang="en">
  <head>
    <% include ./partials/head %>
  </head>
  <body>
    
    <% include ./partials/nav %>

    <div class="container">

      <div class="center-button">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
          Add a new book!
        </button>
      </div>

        <div class="row">          
        <div class="col-md-10 col-md-offset-1">

          <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="exampleModalLabel">Search the archives</h4>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">

                  <div class="input-group">
                    <input class="form-control" type="text" value="" id="search-input" placeholder="book title" required>
                  </div>
                  <button id="submit" class="btn btn-default">Submit</button>
                  <br>
                  <div id="book-list">
                  <!-- search result -->
                  </div>

                </div>
                <!--<div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-primary">Save changes</button>
                </div>-->
              </div>
            </div>
          </div>
            
          <% for(var i=books.length-1; i >= 0; i--) { %>
            <!--<p><%= books[i].title %></p>-->
            <div class="thumbnail">
              <i id="<%= books[i]._id %>" class="fa fa-times" aria-hidden="true"></i>
              <img class="thumbnail_image" src="<%= books[i].imageLink %>" alt="<%= books[i].title %>" >
              <div class="user">
                <p> <%= books[i].author %> <br>
                <%= books[i].title %> </p>
              </div>
            </div>
          <% } %>
        </div>
    </div><!-- /.container -->
  <script>
  // buttons for books to add
  function createButton(id,desc){
    var $input = $('<button>', {
      class: "btn btn-default add-book",
      id: id,
      text: desc,
      click: function(){
        var id = $(this).attr('id');

        $.ajax({
          url: "https://www.googleapis.com/books/v1/volumes?q=id:"+id,
          type: "GET",
        })
        .done(function (data) {

          $.ajax({
            url: '/profile',
            type: 'POST',
            data: { data: data },     
            complete: function(){
              window.location.reload(true);
            }
          });

        });

      }
    });
    $input.appendTo($("#book-list"));
  }
  //
  $("#submit").prop("disabled",true);
  $("#submit").on('click', function(){
    $.ajax({
      url: "https://www.googleapis.com/books/v1/volumes?q="+$("#search-input").val(),
      type: "GET",
    })
    .done(function (data) {
      $("#book-list").empty();
      for(var i = 0; i < 10; i++){
        createButton(data.items[i].id,data.items[i].volumeInfo.title+" - "+data.items[i].volumeInfo.authors);
      }
    });
    $("#search-input").val("");
    $("#submit").prop("disabled",true);
  });
  //
  $('#search-input').on('input', function() {
    if($("#search-input").val()==""){
      $("#submit").prop("disabled",true);
    }else{
      $("#submit").prop("disabled",false);
    }
  });
  //
  $('.fa-times').on('click', function(){
      var id = $(this).attr('id');
      $.ajax({
        url: '/profile/'+id,
        type: 'DELETE',       
        complete: function(){
          window.location.reload(true);
        }
      });
    });
  </script>
  </body>
</html>