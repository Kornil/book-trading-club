<!DOCTYPE html>
<html lang="en">
  <head>
    <% include ./partials/head %>
  </head>
  <body>
    
    <% include ./partials/nav %>

    <div class="container">
        <div class="row">

        <div class="col-xs-12 col-md-4">
          <div class="input-group">
            <input class="form-control" type="text" value="" id="search-input" placeholder="book title" required>
          </div>
            <button id="submit" class="btn btn-default">Submit</button>
            <br>
            <div id="book-list">

            </div>
        </div>
        <div class="col-xs-12 col-md-8">
          <% for(var i=books.length-1; i >= 0; i--) { %>
            <p><%= books[i].title %></p>
          <% } %>
        </div>
        </div>
    </div><!-- /.container -->
  <script>
  function createButton(id,desc){
    var $input = $('<button>', {
      class: "btn btn-default",
      id: id,
      text: desc,
      click: function(){
        var id = $(this).attr('id');
        $.ajax({
        url: '/profile/'+id,
        type: 'POST',       
        complete: function(){
          window.location.reload(true);
        }
      });
      }
    });
    $input.appendTo($("#book-list"));
  }

  $("#submit").prop("disabled",true);
  $("#submit").on('click', function(){
    $.ajax({
      url: "https://www.googleapis.com/books/v1/volumes?q="+$("#search-input").val(),
      type: "GET",
    })
    .done(function (data) {
      $("#book-list").empty();
      for(var i = 0; i < 10; i++){
        createButton(data.items[i].id,data.items[i].volumeInfo.title+" - "+data.items[i].volumeInfo.authors);
      }
    });
    $("#search-input").val("");
    $("#submit").prop("disabled",true);
  });
  $('#search-input').on('input', function() {
    if($("#search-input").val()==""){
      $("#submit").prop("disabled",true);
    }else{
      $("#submit").prop("disabled",false);
    }
  });
  </script>
  </body>
</html>